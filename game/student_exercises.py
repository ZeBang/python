"""
Student Exercises - Stickman Defense Game
å­¦ç”Ÿç»ƒä¹ æ–‡ä»¶ - ç«æŸ´äººé˜²å¾¡æ¸¸æˆ

è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—ç»ƒä¹ ä»»åŠ¡ï¼Œå¸®åŠ©å­¦ç”Ÿé€æ­¥å­¦ä¹ PythonåŸºç¡€çŸ¥è¯†ã€‚
æŒ‰ç…§é¡ºåºå®Œæˆè¿™äº›ç»ƒä¹ ï¼Œä»ç®€å•åˆ°å¤æ‚ã€‚

ä½¿ç”¨æ–¹æ³•ï¼š
1. æ‰“å¼€ game.py
2. æ‰¾åˆ°å¯¹åº”çš„ä»£ç ä½ç½®
3. æŒ‰ç…§ç»ƒä¹ è¯´æ˜ä¿®æ”¹ä»£ç 
4. è¿è¡Œæ¸¸æˆï¼Œè§‚å¯Ÿæ•ˆæœ
"""

# ============================================================================
# ç»ƒä¹ 1ï¼šä¿®æ”¹å˜é‡ï¼ˆæœ€ç®€å•ï¼‰
# ============================================================================
"""
ä»»åŠ¡ï¼šä¿®æ”¹æ¸¸æˆé…ç½®ï¼Œè®©æ¸¸æˆæ›´å®¹æ˜“

ä½ç½®ï¼šgame.py ç¬¬44-49è¡Œ

ç»ƒä¹ ï¼š
1. å°† PLAYER_SPEED æ”¹ä¸º 10ï¼Œè®©ç«æŸ´äººç§»åŠ¨æ›´å¿«
2. å°† BULLET_SPEED æ”¹ä¸º 15ï¼Œè®©å­å¼¹æ›´å¿«
3. å°† MAX_MONSTERS_IN_HOME æ”¹ä¸º 10ï¼Œè®©æ¸¸æˆæ›´å®¹æ˜“

è§‚å¯Ÿï¼šè¿è¡Œæ¸¸æˆï¼Œçœ‹çœ‹è¿™äº›æ”¹å˜å¦‚ä½•å½±å“æ¸¸æˆä½“éªŒ
"""

# ============================================================================
# ç»ƒä¹ 2ï¼šåˆ—è¡¨ä¸­åµŒå¥—å…ƒç»„ï¼šroof_points
# ============================================================================
"""
roof_points = [(...), (...), (...)]ï¼ˆ251â€“255 è¡Œï¼‰
è¿™æ˜¯è®²â€œåˆ—è¡¨ + å…ƒç»„ç»„åˆâ€çš„ç»ä½³ä¾‹å­ï¼š
åˆ—è¡¨ï¼šå­˜å¾ˆå¤šç‚¹ â†’ å¤šä¸ªé¡¶ç‚¹çš„é›†åˆã€‚
å…ƒç»„ï¼šæ¯ä¸€ä¸ªç‚¹ (x, y) æ˜¯ä¸å¸Œæœ›è¢«ä¿®æ”¹çš„å›ºå®šåæ ‡ã€‚
"""


# ============================================================================
# ç»ƒä¹ 3ï¼šç†è§£ if è¯­å¥
# ============================================================================
"""
ä»»åŠ¡ï¼šæ·»åŠ æ–°çš„ç§»åŠ¨é”®

ä½ç½®ï¼šgame.py ç¬¬72-108è¡Œï¼ŒStickman.update() æ–¹æ³•

ç»ƒä¹ ï¼šåœ¨ update() æ–¹æ³•ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œè®©æŒ‰ Q é”®æ—¶å‘å·¦ä¸Šç§»åŠ¨

# åœ¨ # Vertical movement éƒ¨åˆ†ä¹‹åæ·»åŠ ï¼š
if keys[pygame.K_q]:
    dx -= self.speed
    dy -= self.speed

ç†è§£ï¼š
- if è¯­å¥ç”¨äºæ¡ä»¶åˆ¤æ–­
- keys[pygame.K_q] æ£€æŸ¥ Q é”®æ˜¯å¦è¢«æŒ‰ä¸‹
- å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œç¼©è¿›çš„ä»£ç 
"""

# ============================================================================
# ç»ƒä¹ 4ï¼šç†è§£ if-else è¯­å¥
# ============================================================================
"""
ä»»åŠ¡ï¼šæ·»åŠ åŠ é€ŸåŠŸèƒ½

ä½ç½®ï¼šgame.py ç¬¬72-108è¡Œï¼ŒStickman.update() æ–¹æ³•

ç»ƒä¹ ï¼šä¿®æ”¹ç§»åŠ¨ä»£ç ï¼Œè®©æŒ‰ä½ Shift æ—¶ç§»åŠ¨æ›´å¿«

# åœ¨ # Movement - support diagonal movement ä¹‹åæ·»åŠ ï¼š
speed_multiplier = 1  # é»˜è®¤é€Ÿåº¦
if keys[pygame.K_LSHIFT]:  # å¦‚æœæŒ‰ä½å·¦Shifté”®
    speed_multiplier = 2  # é€Ÿåº¦åŠ å€
else:
    speed_multiplier = 1  # æ­£å¸¸é€Ÿåº¦

# ç„¶ååœ¨åº”ç”¨ç§»åŠ¨æ—¶ï¼š
self.x += dx * speed_multiplier
self.y += dy * speed_multiplier

ç†è§£ï¼š
- if-else ç”¨äºä¸¤ç§æƒ…å†µçš„åˆ¤æ–­
- å¦‚æœæ¡ä»¶ä¸ºçœŸæ‰§è¡Œ if å—ï¼Œå¦åˆ™æ‰§è¡Œ else å—
"""

# ============================================================================
# ç»ƒä¹ 5ï¼šç†è§£ for å¾ªç¯
# ============================================================================
"""
ä»»åŠ¡ï¼šé™åˆ¶å­å¼¹æ•°é‡

ä½ç½®ï¼šgame.py ç¬¬114-136è¡Œï¼ŒStickman.shoot() æ–¹æ³•

ç»ƒä¹ ï¼šä¿®æ”¹ shoot() æ–¹æ³•ï¼Œé™åˆ¶æœ€å¤šåªèƒ½æœ‰ 10 å‘å­å¼¹

# åœ¨ shoot() æ–¹æ³•å¼€å¤´æ·»åŠ ï¼š
# æ³¨æ„ï¼šéœ€è¦åœ¨ Game ç±»ä¸­ä¼ é€’ bullets åˆ—è¡¨ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹æ³•
# è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…éœ€è¦åœ¨ Game.update() ä¸­ä¿®æ”¹

ç†è§£ï¼š
- for å¾ªç¯ç”¨äºé‡å¤æ‰§è¡Œä»£ç 
- len() å‡½æ•°è¿”å›åˆ—è¡¨çš„é•¿åº¦
- å¯ä»¥ç”¨ if è¯­å¥æ£€æŸ¥æ¡ä»¶
"""

# ============================================================================
# ç»ƒä¹ 6ï¼šç†è§£ while å¾ªç¯
# ============================================================================
"""
ä»»åŠ¡ï¼šç†è§£æ¸¸æˆä¸»å¾ªç¯

ä½ç½®ï¼šgame.py ç¬¬588-628è¡Œï¼ŒGame.run() æ–¹æ³•

è§‚å¯Ÿï¼šç†è§£è¿™æ®µä»£ç çš„ç»“æ„

while self.running:  # åªè¦æ¸¸æˆè¿è¡Œï¼Œå°±é‡å¤æ‰§è¡Œ
    # 1. å¤„ç†äº‹ä»¶ï¼ˆé”®ç›˜ã€é¼ æ ‡è¾“å…¥ï¼‰
    # 2. æ›´æ–°æ¸¸æˆçŠ¶æ€
    # 3. ç»˜åˆ¶ç”»é¢
    # 4. æ§åˆ¶å¸§ç‡

ç†è§£ï¼š
- while å¾ªç¯ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°æ¡ä»¶ä¸ºå‡
- æ¸¸æˆå¾ªç¯æ˜¯æ¸¸æˆçš„æ ¸å¿ƒ
- æ¯å¸§æ‰§è¡Œä¸€æ¬¡æ›´æ–°å’Œç»˜åˆ¶
"""

# ============================================================================
# ç»ƒä¹ 7ï¼šåˆ›å»ºå‡½æ•°
# ============================================================================
"""
ä»»åŠ¡ï¼šåˆ›å»ºä¸€ä¸ªè®¡ç®—è·ç¦»çš„å‡½æ•°

ä½ç½®ï¼šå¯ä»¥åœ¨æ–‡ä»¶å¼€å¤´ï¼ˆç±»å®šä¹‰ä¹‹å‰ï¼‰æ·»åŠ 

ç»ƒä¹ ï¼šåˆ›å»ºä»¥ä¸‹å‡½æ•°

def calculate_distance(x1, y1, x2, y2):
    \"\"\"
    è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
    å‚æ•°ï¼š
    - x1, y1: ç¬¬ä¸€ä¸ªç‚¹çš„åæ ‡
    - x2, y2: ç¬¬äºŒä¸ªç‚¹çš„åæ ‡
    è¿”å›ï¼šä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
    \"\"\"
    dx = x2 - x1
    dy = y2 - y1
    distance = math.sqrt(dx*dx + dy*dy)
    return distance

ç„¶ååœ¨ç¢°æ’æ£€æµ‹ä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼š
# åœ¨ Game.update() æ–¹æ³•ä¸­ï¼Œæ‰¾åˆ°ç¢°æ’æ£€æµ‹éƒ¨åˆ†
# å°†åŸæ¥çš„è·ç¦»è®¡ç®—æ›¿æ¢ä¸ºï¼š
distance = calculate_distance(bullet.x, bullet.y, monster.x, monster.y)

ç†è§£ï¼š
- å‡½æ•°ç”¨äºç»„ç»‡ä»£ç ï¼Œé¿å…é‡å¤
- å‚æ•°æ˜¯å‡½æ•°çš„è¾“å…¥
- return æ˜¯å‡½æ•°çš„è¾“å‡º
"""

# ============================================================================
# ç»ƒä¹ 8ï¼šä¿®æ”¹ç±»çš„æ–¹æ³•
# ============================================================================
"""
ä»»åŠ¡ï¼šç»™ç«æŸ´äººæ·»åŠ èƒ½é‡ç³»ç»Ÿ

ä½ç½®ï¼šgame.py ç¬¬59-136è¡Œï¼ŒStickman ç±»

ç»ƒä¹ 1ï¼šæ·»åŠ èƒ½é‡å±æ€§
# åœ¨ __init__() æ–¹æ³•ä¸­æ·»åŠ ï¼š
self.energy = 100
self.max_energy = 100

ç»ƒä¹ 2ï¼šåˆ›å»ºä½¿ç”¨èƒ½é‡çš„æ–¹æ³•
# åœ¨ Stickman ç±»ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼š
def use_energy(self, amount):
    \"\"\"ä½¿ç”¨èƒ½é‡\"\"\"
    if self.energy >= amount:
        self.energy -= amount
        return True
    return False

ç»ƒä¹ 3ï¼šä¿®æ”¹å°„å‡»ï¼Œæ¶ˆè€—èƒ½é‡
# åœ¨ shoot() æ–¹æ³•ä¸­ï¼Œæ·»åŠ èƒ½é‡æ£€æŸ¥ï¼š
if not self.use_energy(10):
    return None  # èƒ½é‡ä¸è¶³ï¼Œä¸èƒ½å°„å‡»

ç†è§£ï¼š
- ç±»çš„æ–¹æ³•å¯ä»¥è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å±æ€§
- self ä»£è¡¨å¯¹è±¡æœ¬èº«
- æ–¹æ³•å¯ä»¥è¿”å›å€¼
"""

# ============================================================================
# ç»ƒä¹ 9ï¼šåˆ—è¡¨æ“ä½œ
# ============================================================================
"""
ä»»åŠ¡ï¼šæ·»åŠ ä¸åŒç±»å‹çš„æ€ªç‰©

ä½ç½®ï¼šgame.py ç¬¬409-412è¡Œï¼ŒGame.spawn_monster() æ–¹æ³•

ç»ƒä¹ ï¼šä¿®æ”¹ spawn_monster() æ–¹æ³•ï¼Œéšæœºç”Ÿæˆä¸åŒç±»å‹çš„æ€ªç‰©

def spawn_monster(self):
    y = random.randint(50, SCREEN_HEIGHT - 50)
    monster_type = random.choice(['normal', 'fast', 'slow'])
    
    monster = Monster(SPAWN_X, y)
    
    if monster_type == 'fast':
        monster.speed = 5
        monster.color = RED
    elif monster_type == 'slow':
        monster.speed = 1
        monster.color = BLUE
    else:
        monster.speed = 3
        monster.color = ORANGE
    
    self.monsters.append(monster)

ç†è§£ï¼š
- random.choice() ä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ 
- if-elif-else ç”¨äºå¤šä¸ªæ¡ä»¶çš„åˆ¤æ–­
- åˆ—è¡¨çš„ append() æ–¹æ³•ç”¨äºæ·»åŠ å…ƒç´ 
"""

# ============================================================================
# ç»ƒä¹ 10ï¼šç»¼åˆç»ƒä¹  - æ·»åŠ åˆ†æ•°ç³»ç»Ÿ
# ============================================================================
"""
ä»»åŠ¡ï¼šåˆ›å»ºæ›´å¤æ‚çš„åˆ†æ•°ç³»ç»Ÿ

ä½ç½®ï¼šgame.py ç¬¬414-500è¡Œï¼ŒGame.update() æ–¹æ³•

ç»ƒä¹ ï¼šæ ¹æ®æ€ªç‰©ç±»å‹ç»™äºˆä¸åŒåˆ†æ•°

# åœ¨å‡»ä¸­æ€ªç‰©åï¼Œä¿®æ”¹åˆ†æ•°è®¡ç®—ï¼š
if distance < bullet.size + monster.size:
    # æ ¹æ®æ€ªç‰©é€Ÿåº¦ç»™äºˆä¸åŒåˆ†æ•°
    if monster.speed >= 4:
        self.score += 20  # å¿«é€Ÿæ€ªç‰©ç»™æ›´å¤šåˆ†
    elif monster.speed <= 2:
        self.score += 5   # æ…¢é€Ÿæ€ªç‰©ç»™è¾ƒå°‘åˆ†
    else:
        self.score += 10  # æ™®é€šæ€ªç‰©
    
    self.bullets.remove(bullet)
    self.monsters.remove(monster)
    break

ç†è§£ï¼š
- ç»¼åˆè¿ç”¨ if-elif-else
- æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„æ“ä½œ
- ç†è§£æ¸¸æˆé€»è¾‘çš„å®ç°
"""

# ============================================================================
# ç»ƒä¹ 11ï¼šæŒ‘æˆ˜é¢˜ - æ·»åŠ è¿å‡»ç³»ç»Ÿ
# ============================================================================
"""
ä»»åŠ¡ï¼šåˆ›å»ºè¿å‡»ç³»ç»Ÿï¼ˆé«˜çº§ï¼‰

ä½ç½®ï¼šgame.py ç¬¬381-407è¡Œï¼ŒGame.__init__() æ–¹æ³•

ç»ƒä¹ ï¼š
1. åœ¨ __init__() ä¸­æ·»åŠ è¿å‡»ç›¸å…³å˜é‡ï¼š
   self.combo = 0
   self.combo_timer = 0
   self.max_combo = 0

2. åœ¨ update() æ–¹æ³•ä¸­æ›´æ–°è¿å‡»ï¼š
   # åœ¨å‡»ä¸­æ€ªç‰©åï¼š
   self.combo += 1
   self.combo_timer = 180  # 3ç§’å†…å¿…é¡»å†æ¬¡å‡»ä¸­
   
   # åœ¨ update() å¼€å¤´ï¼š
   if self.combo_timer > 0:
       self.combo_timer -= 1
   else:
       if self.combo > self.max_combo:
           self.max_combo = self.combo
       self.combo = 0

3. åœ¨ draw_ui() ä¸­æ˜¾ç¤ºè¿å‡»ï¼š
   if self.combo > 0:
       combo_text = self.font_small.render(f"Combo: {self.combo}x", True, YELLOW)
       self.screen.blit(combo_text, (10, 170))

ç†è§£ï¼š
- ç»¼åˆè¿ç”¨æ‰€æœ‰å­¦è¿‡çš„æ¦‚å¿µ
- ç†è§£æ¸¸æˆç³»ç»Ÿçš„è®¾è®¡
- å­¦ä¼šæ·»åŠ æ–°åŠŸèƒ½
"""

# ============================================================================
# å­¦ä¹ æ£€æŸ¥æ¸…å•
# ============================================================================
"""
å®Œæˆè¿™äº›ç»ƒä¹ åï¼Œæ£€æŸ¥ä½ æ˜¯å¦ç†è§£ï¼š

â–¡ å˜é‡å’Œå¸¸é‡
  - çŸ¥é“å¦‚ä½•ä¿®æ”¹å˜é‡çš„å€¼
  - ç†è§£å˜é‡å¯¹æ¸¸æˆçš„å½±å“

â–¡ æ¡ä»¶è¯­å¥ (if/else)
  - èƒ½å¤Ÿä½¿ç”¨ if è¯­å¥åšåˆ¤æ–­
  - ç†è§£ if-elif-else çš„ä½¿ç”¨
  - èƒ½å¤Ÿæ·»åŠ æ–°çš„æ¡ä»¶é€»è¾‘

â–¡ å¾ªç¯ (for/while)
  - ç†è§£ for å¾ªç¯éå†åˆ—è¡¨
  - ç†è§£ while å¾ªç¯çš„ä½œç”¨
  - çŸ¥é“å¦‚ä½•æ§åˆ¶å¾ªç¯

â–¡ å‡½æ•°
  - èƒ½å¤Ÿåˆ›å»ºç®€å•çš„å‡½æ•°
  - ç†è§£å‚æ•°å’Œè¿”å›å€¼
  - çŸ¥é“å¦‚ä½•è°ƒç”¨å‡½æ•°

â–¡ ç±»å’Œå¯¹è±¡
  - ç†è§£ç±»çš„åŸºæœ¬æ¦‚å¿µ
  - çŸ¥é“å¦‚ä½•æ·»åŠ å±æ€§å’Œæ–¹æ³•
  - ç†è§£ self çš„ä½œç”¨

â–¡ åˆ—è¡¨æ“ä½œ
  - çŸ¥é“å¦‚ä½•æ·»åŠ å’Œåˆ é™¤å…ƒç´ 
  - ç†è§£åˆ—è¡¨çš„éå†
  - èƒ½å¤Ÿä½¿ç”¨åˆ—è¡¨ç®¡ç†æ¸¸æˆå¯¹è±¡

å¦‚æœéƒ½ç†è§£äº†ï¼Œæ­å–œä½ ï¼ä½ å·²ç»æŒæ¡äº†Pythonçš„åŸºç¡€çŸ¥è¯†ï¼ğŸ‰
"""
